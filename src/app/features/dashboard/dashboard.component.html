<h1 class="page-title">Resumen general</h1>

<div class="dashboard-container">
  <ng-container *ngIf="isMobile; else desktopCards">
    <mat-accordion>
      <mat-expansion-panel [expanded]="cardsExpanded">
        <mat-expansion-panel-header (click)="cardsExpanded = !cardsExpanded">
          <mat-panel-title>
            Tarjetas de Crédito
          </mat-panel-title>
        </mat-expansion-panel-header>
        <app-cards #cards></app-cards>
      </mat-expansion-panel>
    </mat-accordion>
  </ng-container>
  <ng-template #desktopCards>
    <app-cards #cards></app-cards>
  </ng-template>

  <!-- MOBILE TOOLBAR -->
  <div *ngIf="isMobile" class="dashboard-toolbar-row mobile-toolbar">
    <button mat-mini-fab color="primary" class="custom-button" (click)="onNewExpense()" matTooltip="Nuevo Gasto">
      <mat-icon>add</mat-icon>
    </button>
    <span class="toolbar-spacer"></span>
    <mat-button-toggle-group [value]="showCharts ? 'charts' : 'table'" (change)="toggleView($event)" exclusive
      class="mobile-toggle-group">
      <mat-button-toggle value="table" matTooltip="Ver como Tabla">
        <mat-icon>table_view</mat-icon>
      </mat-button-toggle>
      <mat-button-toggle value="charts" matTooltip="Ver como Gráficos">
        <mat-icon>insert_chart</mat-icon>
      </mat-button-toggle>
    </mat-button-toggle-group>
  </div>

  <!-- DESKTOP TOOLBAR -->
  <div *ngIf="!isMobile" class="dashboard-toolbar-row">
    <button mat-raised-button color="primary" type="button" class="custom-button" (click)="onNewExpense()">
      <mat-icon>add</mat-icon>
      Nuevo Gasto
    </button>
    <span class="toolbar-spacer"></span>
    <mat-button-toggle-group [value]="showCharts ? 'charts' : 'table'" (change)="toggleView($event)" exclusive>
      <mat-button-toggle value="table">Ver como Tabla</mat-button-toggle>
      <mat-button-toggle value="charts">Ver como Gráficos</mat-button-toggle>
    </mat-button-toggle-group>
  </div>

  <div *ngIf="!showCharts">
    <app-grid #grid (expenseAdded)="onExpenseAdded()"></app-grid>
  </div>

  <div *ngIf="showCharts" class="dashboard-charts-row">
    <div class="dashboard-charts-col">
      <h2 class="chart-title">Gastos por Categoría</h2>
      <p class="chart-desc">Distribución de los gastos del mes actual agrupados por categoría.</p>
      <app-doughnut-category-chart [chartData]="doughnutData.chartData" *ngIf="doughnutData.chartOptions"
        [chartOptions]="doughnutData.chartOptions"></app-doughnut-category-chart>
    </div>
    <div class="dashboard-charts-col">
      <h2 class="chart-title">Evolución Mensual</h2>
      <p class="chart-desc">Total gastado mes a mes durante el último año.</p>
      <app-bar-monthly-evolution-chart [chartData]="barData.chartData" *ngIf="barData.chartOptions"
        [chartOptions]="barData.chartOptions"></app-bar-monthly-evolution-chart>
    </div>
    <div class="dashboard-charts-col" style="grid-column: 1 / span 2;">
      <h2 class="chart-title">Gastos por Tarjeta de Crédito</h2>
      <p class="chart-desc">Proporción de gastos del mes actual por cada tarjeta de crédito.</p>
      <app-pie-card-distribution-chart [chartData]="pieData.chartData" *ngIf="pieData.chartOptions"
        [chartOptions]="pieData.chartOptions"></app-pie-card-distribution-chart>
    </div>
  </div>
</div>
